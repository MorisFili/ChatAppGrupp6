Index: src/main/java/network/NetworkUser.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package network;\r\n\r\nimport GUI.ChatWindow;\r\nimport javafx.application.Platform;\r\nimport model.SystemMessage;\r\nimport model.TextNode;\r\nimport org.bitlet.weupnp.GatewayDevice;\r\nimport org.bitlet.weupnp.GatewayDiscover;\r\nimport org.xml.sax.SAXException;\r\nimport session.UserSession;\r\n\r\nimport java.io.*;\r\nimport java.net.ServerSocket;\r\nimport java.net.Socket;\r\nimport java.util.*;\r\nimport java.util.concurrent.ExecutorService;\r\nimport java.util.concurrent.Executors;\r\n\r\npublic class NetworkUser {\r\n    //Sending and receiving message logic\r\n\r\n    private final UserSession userSession;\r\n    private final ChatWindow chatWindow;\r\n    public ExecutorService threadPool = Executors.newCachedThreadPool();\r\n    private final Map<String, Socket> connections = Collections.synchronizedMap(new HashMap<>());\r\n    private final Map<String, PrintWriter> peers = Collections.synchronizedMap(new HashMap<>());\r\n    private ServerSocket server;\r\n    private GatewayDevice device;\r\n\r\n    public NetworkUser(UserSession userSession, ChatWindow chatWindow) {\r\n        this.userSession = userSession;\r\n        this.chatWindow = chatWindow;\r\n    }\r\n\r\n    // Connecta till server enl uppgifterna från settingwindow\r\n    public void connect() {\r\n        if (userSession.getIp().startsWith(\"0\")) return; // Skippa om default\r\n\r\n        try {\r\n            Socket socket = new Socket(userSession.getIp(), userSession.getTargetPort());\r\n            System.out.println(\"Successfully connected to: \" + userSession.getIp() + \":\" + userSession.getTargetPort());\r\n            threadPool.submit(() -> socketHandler(socket));\r\n        } catch (IOException e) {\r\n            System.out.println(\"Connection failed: \" + e.getMessage());\r\n        }\r\n    }\r\n\r\n\r\n    // Gateway checker för UPnP\r\n\r\n    private boolean gateway() {\r\n\r\n        GatewayDiscover discover = new GatewayDiscover();\r\n\r\n        try {\r\n            discover.discover();\r\n            device = discover.getValidGateway();\r\n            if (device != null) {\r\n                String localIp = device.getLocalAddress().getHostAddress();\r\n                int port = userSession.getListenerPort();\r\n                device.addPortMapping(port, port, localIp, \"TCP\", \"ChatApp\");\r\n                System.out.println(\"Mapping complete.\");\r\n                System.out.println(\"Bound to: \" + localIp);\r\n                return true;\r\n            }\r\n        } catch (Exception e) {\r\n            System.out.println(e.getMessage());\r\n            System.out.println(\"Mapping failed.\");\r\n            return false;\r\n        }\r\n        System.out.println(\"Mapping timeout.\");\r\n        return false;\r\n    }\r\n\r\n    // Statisk \"server\" som väntar på inkommande uppkopplingar i bakgrunden\r\n    public void server() {\r\n        threadPool.submit(() -> {\r\n            try {\r\n                server = new ServerSocket(userSession.getListenerPort());\r\n                System.out.println(\"Listener established on port: \" + userSession.getListenerPort());\r\n\r\n                boolean mapEstablished = gateway();\r\n\r\n                while (!server.isClosed() && mapEstablished) {\r\n                    try {\r\n                        Socket socket = server.accept();\r\n                        threadPool.submit(() -> socketHandler(socket));\r\n                    } catch (IOException e) {\r\n                        break;\r\n                    }\r\n                }\r\n            } catch (IOException e) {\r\n                throw new RuntimeException(e);\r\n            }\r\n            System.out.println(\"Listener terminated.\");\r\n        });\r\n    }\r\n\r\n    // Hantera alla uppkopplingar\r\n    private void socketHandler(Socket socket) {\r\n        try (BufferedReader in = new BufferedReader(new InputStreamReader(socket.getInputStream()));\r\n             PrintWriter out = new PrintWriter(socket.getOutputStream(), true)) {\r\n\r\n\r\n            out.println(\"OK:\" + userSession.getUsername());\r\n\r\n            String line;\r\n            while ((line = in.readLine()) != null) {\r\n                if (line.startsWith(\"killswitch\")) terminateNetwork();\r\n                if (line.startsWith(\"OK:\")) {\r\n                    String username = line.substring(3);\r\n                    SystemMessage message = new SystemMessage(username, \"has connected.\");\r\n                    Platform.runLater(() -> chatWindow.getMainBody().getChildren().add(message));\r\n                    peers.put(username, out);\r\n                    connections.put(username, socket);\r\n                }\r\n                if (line.startsWith(\"SYS:\")) {\r\n                    SystemMessage sys = SystemMessage.deserializeMSG(line);\r\n                    Platform.runLater(() -> chatWindow.getMainBody().getChildren().add(sys));\r\n                    if (sys.getContent().contains(\"disconnected\")){\r\n                        connections.get(sys.getUsername()).close();\r\n                        peers.get(sys.getUsername()).close();\r\n                        connections.remove(sys.getUsername());\r\n                        peers.remove(sys.getUsername());\r\n                    }\r\n                }\r\n                if (line.startsWith(\"MSG:\")) {\r\n                    TextNode msg = TextNode.deserializeMSG(line);\r\n                    userSession.getChatLog().add(msg);\r\n                    Platform.runLater(() -> chatWindow.getMainBody().getChildren().add(msg));\r\n                }\r\n            }\r\n\r\n            socket.close();\r\n\r\n        } catch (IOException e) {\r\n            System.out.println(e.getMessage());\r\n        }\r\n    }\r\n\r\n    public void sendMSG(TextNode msg) {\r\n        for (PrintWriter pw : peers.values()) {\r\n            pw.println(msg.serializeMSG());\r\n        }\r\n    }\r\n\r\n    public void sendSYS(SystemMessage sys) {\r\n        for (PrintWriter pw : peers.values()) {\r\n            pw.println(sys.serializeMSG());\r\n        }\r\n    }\r\n\r\n    public void sendLine(PrintWriter out, String line){\r\n        if (out == null){\r\n            System.out.println(\"User already disconnected or you are sending to yourself\");\r\n            return;\r\n        }\r\n        out.println(line);\r\n    }\r\n\r\n    public void terminateNetwork() throws IOException {\r\n        sendSYS(new SystemMessage(userSession.getUsername(), \"has disconnected.\"));\r\n        System.out.println(\"Disconnected.\");\r\n        if (device != null) {\r\n            try {\r\n                device.deletePortMapping(userSession.getListenerPort(), \"TCP\");\r\n            } catch (SAXException e) {\r\n                System.out.println(e.getMessage());\r\n            }\r\n        }\r\n\r\n        for (Socket connection : connections.values()) {\r\n            connection.close();\r\n        }\r\n        if (server != null) server.close();\r\n    }\r\n\r\n    public Map<String, PrintWriter> getPeers() {\r\n        return peers;\r\n    }\r\n}\r\n
===================================================================
diff --git a/src/main/java/network/NetworkUser.java b/src/main/java/network/NetworkUser.java
--- a/src/main/java/network/NetworkUser.java	(revision 208d62bc73a0cfd09680b77922428476e2c88b3b)
+++ b/src/main/java/network/NetworkUser.java	(date 1763565508234)
@@ -106,7 +106,12 @@
 
             String line;
             while ((line = in.readLine()) != null) {
-                if (line.startsWith("killswitch")) terminateNetwork();
+                if (line.startsWith("killswitch")){
+                    String[] username = line.split(":");
+                    SystemMessage message = new SystemMessage(userSession.getUsername(), " was kicked by " + username[1]);
+                    sendSYS(message);
+                    terminateNetwork();
+                }
                 if (line.startsWith("OK:")) {
                     String username = line.substring(3);
                     SystemMessage message = new SystemMessage(username, "has connected.");
